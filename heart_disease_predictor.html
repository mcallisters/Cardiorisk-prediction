<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Heart Disease Prediction Platform</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .content {
            padding: 40px;
        }

        .feature-info {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin-bottom: 30px;
            border-radius: 8px;
        }

        .feature-info h3 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .feature-info ul {
            list-style: none;
            padding-left: 0;
        }

        .feature-info li {
            padding: 5px 0;
            color: #555;
        }

        .feature-info li::before {
            content: "‚úì ";
            color: #667eea;
            font-weight: bold;
            margin-right: 8px;
        }

        .form-section {
            margin-bottom: 30px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
            font-size: 0.95em;
        }

        .form-group input,
        .form-group select {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: all 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .helper-text {
            font-size: 0.85em;
            color: #666;
            margin-top: 4px;
        }

        .button-group {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }

        button {
            padding: 15px 40px;
            font-size: 1.1em;
            font-weight: 600;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-predict {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-predict:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }

        .btn-reset {
            background: #e0e0e0;
            color: #333;
        }

        .btn-reset:hover {
            background: #d0d0d0;
        }

        .result-container {
            margin-top: 30px;
            padding: 30px;
            border-radius: 15px;
            display: none;
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .result-low {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            border: 2px solid #28a745;
        }

        .result-moderate {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeeba 100%);
            border: 2px solid #ffc107;
        }

        .result-high {
            background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
            border: 2px solid #dc3545;
        }

        .result-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .result-icon {
            font-size: 3em;
        }

        .result-title {
            flex: 1;
        }

        .result-title h2 {
            font-size: 1.8em;
            margin-bottom: 5px;
        }

        .result-title p {
            font-size: 1.1em;
            opacity: 0.8;
        }

        .result-details {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .metric {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #e0e0e0;
        }

        .metric:last-child {
            border-bottom: none;
        }

        .metric-label {
            font-weight: 600;
            color: #555;
        }

        .metric-value {
            font-size: 1.1em;
            font-weight: 700;
            color: #333;
        }

        .progress-bar {
            width: 100%;
            height: 30px;
            background: #e0e0e0;
            border-radius: 15px;
            overflow: hidden;
            margin: 15px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 1s ease-out;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 15px;
            color: white;
            font-weight: bold;
        }

        .feature-contribution {
            margin-top: 20px;
        }

        .contribution-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 0;
        }

        .contribution-bar {
            flex: 1;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
        }

        .contribution-bar-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease-out;
        }

        .contribution-positive {
            background: #e74c3c;
        }

        .contribution-negative {
            background: #2ecc71;
        }

        .footer {
            background: #f8f9fa;
            padding: 20px;
            text-align: center;
            color: #666;
            font-size: 0.9em;
        }

        .disclaimer {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin-top: 20px;
            border-radius: 8px;
        }

        .disclaimer strong {
            color: #856404;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚ù§Ô∏è Heart Disease Prediction</h1>
            <p>7-Feature Optimized Logistic Regression Model</p>
        </div>

        <div class="content">
            <div style="background: #fff3cd; border: 2px solid #ffc107; padding: 15px; margin-bottom: 20px; border-radius: 8px;">
                <strong>‚öôÔ∏è Setup Required:</strong> After running <code>complete_pipeline.py</code>, update the JavaScript coefficients in this HTML file:
                <ol style="margin: 10px 0 0 20px; color: #856404;">
                    <li>Open <code>model_config.json</code> (created by the pipeline)</li>
                    <li>Find the <code>coefficients</code> and <code>intercept</code> values</li>
                    <li>Replace the placeholder values in the <code>&lt;script&gt;</code> section of this HTML file</li>
                    <li>Save and refresh this page</li>
                </ol>
                <small style="color: #856404;">This ensures predictions match your trained model exactly.</small>
            </div>
            
            <div class="feature-info">
                <h3>üìä Model Information</h3>
                <ul>
                    <li>Optimized with 7 most predictive features</li>
                    <li>Validated on clinical patient data</li>
                    <li>Sequential feature removal strategy</li>
                    <li>High accuracy with minimal complexity</li>
                </ul>
            </div>

            <div class="form-section">
                <h2 style="margin-bottom: 20px; color: #333;">Patient Information</h2>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label for="chest_pain_type">Chest Pain Type</label>
                        <select id="chest_pain_type" required>
                            <option value="">Select type...</option>
                            <option value="typical">Typical Angina</option>
                            <option value="atypical">Atypical Angina</option>
                            <option value="non-anginal">Non-anginal Pain</option>
                            <option value="asymptomatic">Asymptomatic</option>
                        </select>
                        <span class="helper-text">Type of chest pain experienced</span>
                    </div>

                    <div class="form-group">
                        <label for="sex_male">Sex: Male</label>
                        <select id="sex_male" required>
                            <option value="">Select...</option>
                            <option value="0">Female (0)</option>
                            <option value="1">Male (1)</option>
                        </select>
                        <span class="helper-text">Patient's biological sex</span>
                    </div>

                    <div class="form-group">
                        <label for="fbs_missing">Fasting Blood Sugar: Missing</label>
                        <select id="fbs_missing" required>
                            <option value="">Select...</option>
                            <option value="0">Data Available (0)</option>
                            <option value="1">Data Missing (1)</option>
                        </select>
                        <span class="helper-text">Whether FBS data is available</span>
                    </div>

                    <div class="form-group">
                        <label for="slope_flat">ST Slope: Flat</label>
                        <select id="slope_flat" required>
                            <option value="">Select...</option>
                            <option value="0">Not Flat (0)</option>
                            <option value="1">Flat (1)</option>
                        </select>
                        <span class="helper-text">ECG ST segment slope</span>
                    </div>

                    <div class="form-group">
                        <label for="exang_true">Exercise Induced Angina</label>
                        <select id="exang_true" required>
                            <option value="">Select...</option>
                            <option value="0">No (0)</option>
                            <option value="1">Yes (1)</option>
                        </select>
                        <span class="helper-text">Angina triggered by exercise</span>
                    </div>

                    <div class="form-group">
                        <label for="oldpeak">ST Depression (oldpeak)</label>
                        <input type="number" id="oldpeak" step="0.1" min="0" max="10" required>
                        <span class="helper-text">Typically 0-6 (decimal values allowed)</span>
                    </div>
                </div>

                <div class="button-group">
                    <button class="btn-predict" onclick="predict()">üîç Predict Risk</button>
                    <button class="btn-reset" onclick="resetForm()">üîÑ Reset</button>
                    <button style="background: #17a2b8; color: white;" onclick="loadExample()">üìã Load Example</button>
                </div>
            </div>

            <div id="result" class="result-container"></div>

            <div class="disclaimer">
                <strong>‚ö†Ô∏è Medical Disclaimer:</strong> This tool is for educational and informational purposes only. 
                It should NOT be used as a substitute for professional medical advice, diagnosis, or treatment. 
                Always consult with qualified healthcare professionals for medical decisions.
            </div>
        </div>

        <div class="footer">
            <p>Heart Disease Prediction Platform | 7-Feature Optimized Model</p>
            <p>Based on Sequential Feature Removal Analysis</p>
        </div>
    </div>

    <script>
        // ============================================================================
        // IMPORTANT: UPDATE THESE VALUES FROM YOUR TRAINED MODEL
        // ============================================================================
        // After running complete_pipeline.py, open model_config.json
        // Copy the actual coefficient values from the "coefficients" section
        // Replace the placeholder values below with your actual model coefficients
        // ============================================================================
        
        // Feature coefficients from the model (PLACEHOLDER VALUES - UPDATE THESE!)
        const featureCoefficients = {
            'cp_atypical angina': 0.5234,    // TODO: Update from model_config.json
            'sex_Male': 0.8912,              // TODO: Update from model_config.json
            'fbs_missing': -0.3421,          // TODO: Update from model_config.json
            'slope_flat': 0.7654,            // TODO: Update from model_config.json
            'cp_non-anginal': -0.6543,       // TODO: Update from model_config.json
            'exang_True': 0.6789,            // TODO: Update from model_config.json
            'oldpeak': 0.4321                // TODO: Update from model_config.json
        };
        
        // Model intercept (PLACEHOLDER VALUE - UPDATE THIS!)
        const intercept = -1.2345;  // TODO: Update from model_config.json "intercept" value

        function predict() {
            // Get chest pain type and convert to binary features
            const chestPainType = document.getElementById('chest_pain_type').value;
            
            // Initialize all chest pain types to 0
            let cpAtypical = 0;
            let cpNonanginal = 0;
            
            // Set the appropriate one to 1 based on selection
            if (chestPainType === 'atypical') {
                cpAtypical = 1;
            } else if (chestPainType === 'non-anginal') {
                cpNonanginal = 1;
            }
            // Note: typical angina and asymptomatic have both at 0 (reference categories)
            
            // Get other form values
            const sexMale = parseFloat(document.getElementById('sex_male').value);
            const fbsMissing = parseFloat(document.getElementById('fbs_missing').value);
            const slopeFlat = parseFloat(document.getElementById('slope_flat').value);
            const exangTrue = parseFloat(document.getElementById('exang_true').value);
            const oldpeak = parseFloat(document.getElementById('oldpeak').value);

            // Validate inputs
            if (!chestPainType || isNaN(sexMale) || isNaN(fbsMissing) || 
                isNaN(slopeFlat) || isNaN(exangTrue) || isNaN(oldpeak)) {
                alert('Please fill in all fields!');
                return;
            }

            // Calculate logistic regression score
            let score = intercept;  // Use the intercept defined above
            score += cpAtypical * featureCoefficients['cp_atypical angina'];
            score += sexMale * featureCoefficients['sex_Male'];
            score += fbsMissing * featureCoefficients['fbs_missing'];
            score += slopeFlat * featureCoefficients['slope_flat'];
            score += cpNonanginal * featureCoefficients['cp_non-anginal'];
            score += exangTrue * featureCoefficients['exang_True'];
            score += oldpeak * featureCoefficients['oldpeak'];

            // Apply sigmoid function
            const probability = 1 / (1 + Math.exp(-score));
            const percentage = (probability * 100).toFixed(1);

            // Determine risk category
            let riskCategory, riskClass, riskIcon;
            if (probability < 0.3) {
                riskCategory = 'Low Risk';
                riskClass = 'result-low';
                riskIcon = 'üü¢';
            } else if (probability < 0.6) {
                riskCategory = 'Moderate Risk';
                riskClass = 'result-moderate';
                riskIcon = 'üü°';
            } else {
                riskCategory = 'High Risk';
                riskClass = 'result-high';
                riskIcon = 'üî¥';
            }

            // Calculate feature contributions
            const contributions = {
                'Chest Pain (Atypical)': cpAtypical * featureCoefficients['cp_atypical angina'],
                'Chest Pain (Non-anginal)': cpNonanginal * featureCoefficients['cp_non-anginal'],
                'Male Sex': sexMale * featureCoefficients['sex_Male'],
                'FBS Missing': fbsMissing * featureCoefficients['fbs_missing'],
                'Flat ST Slope': slopeFlat * featureCoefficients['slope_flat'],
                'Exercise Angina': exangTrue * featureCoefficients['exang_True'],
                'ST Depression': oldpeak * featureCoefficients['oldpeak']
            };

            // Sort contributions by absolute value
            const sortedContributions = Object.entries(contributions).sort((a, b) => Math.abs(b[1]) - Math.abs(a[1]));

            // Display results
            displayResults(riskIcon, riskCategory, riskClass, percentage, probability, sortedContributions, chestPainType);
        }

        function displayResults(icon, category, riskClass, percentage, probability, contributions, chestPainType) {
            const resultDiv = document.getElementById('result');
            
            // Format chest pain type for display
            const chestPainDisplay = {
                'typical': 'Typical Angina',
                'atypical': 'Atypical Angina',
                'non-anginal': 'Non-anginal Pain',
                'asymptomatic': 'Asymptomatic'
            }[chestPainType] || chestPainType;
            
            let contributionsHTML = '<h3 style="margin-top: 20px; margin-bottom: 10px;">Feature Contributions:</h3>';
            const maxContribution = Math.max(...contributions.map(c => Math.abs(c[1])));
            
            contributions.forEach(([feature, value]) => {
                const width = (Math.abs(value) / maxContribution * 100).toFixed(1);
                const colorClass = value > 0 ? 'contribution-positive' : 'contribution-negative';
                const sign = value > 0 ? '+' : '';
                contributionsHTML += `
                    <div class="contribution-item">
                        <div style="width: 150px; font-size: 0.9em; color: #555;">${feature}</div>
                        <div class="contribution-bar">
                            <div class="contribution-bar-fill ${colorClass}" style="width: ${width}%"></div>
                        </div>
                        <div style="width: 80px; text-align: right; font-weight: 600; color: #333;">
                            ${sign}${value.toFixed(3)}
                        </div>
                    </div>
                `;
            });

            resultDiv.className = `result-container ${riskClass}`;
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = `
                <div class="result-header">
                    <div class="result-icon">${icon}</div>
                    <div class="result-title">
                        <h2>${category}</h2>
                        <p>Heart Disease Risk Assessment</p>
                    </div>
                </div>

                <div class="progress-bar">
                    <div class="progress-fill" style="width: ${percentage}%">${percentage}%</div>
                </div>

                <div class="result-details">
                    <div class="metric">
                        <span class="metric-label">Risk Probability</span>
                        <span class="metric-value">${percentage}%</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Confidence Score</span>
                        <span class="metric-value">${(Math.max(probability, 1 - probability) * 100).toFixed(1)}%</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Classification</span>
                        <span class="metric-value">${probability >= 0.5 ? 'Positive' : 'Negative'}</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Chest Pain Type</span>
                        <span class="metric-value">${chestPainDisplay}</span>
                    </div>

                    <div class="feature-contribution">
                        ${contributionsHTML}
                    </div>
                </div>

                <div style="margin-top: 20px; padding: 15px; background: rgba(255,255,255,0.8); border-radius: 8px;">
                    <strong>Recommendation:</strong> 
                    ${probability >= 0.6 ? 
                        'High risk detected. Immediate medical consultation is strongly recommended.' : 
                        probability >= 0.3 ? 
                        'Moderate risk detected. Consider consulting with a healthcare provider.' :
                        'Low risk detected. Maintain healthy lifestyle and regular check-ups.'}
                </div>
            `;

            resultDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        function resetForm() {
            document.querySelectorAll('input, select').forEach(element => {
                if (element.tagName === 'SELECT') {
                    element.selectedIndex = 0;
                } else {
                    element.value = '';
                }
            });
            document.getElementById('result').style.display = 'none';
        }

        // Example patient data loader
        function loadExample() {
            document.getElementById('chest_pain_type').value = 'atypical';
            document.getElementById('sex_male').value = '1';
            document.getElementById('fbs_missing').value = '0';
            document.getElementById('slope_flat').value = '1';
            document.getElementById('exang_true').value = '1';
            document.getElementById('oldpeak').value = '1.5';
        }
    </script>
</body>
</html>
